{% import "utils.html" as utils %}
{% set db = request.get_db() %}

{% extends "layout.html" %}
{% set components = [(testsuite_name, v4_url_for("v4_recent_activity")),
                      ("Tracking", v4_url_for("v4_regression_list"))] %}
{% block title %}Regression Details{% endblock %}

{% block body %}
<section id="Regression Detail" />
<h3>Regression: {{regression.title}}</h3>
<a href="{{regression.bug}}">{{regression.bug}}</a>
<form method="POST" action="">
<table class="table table-striped table-hover table-condensed">
  <caption>This needs to be dynamically queried</caption>

  <thead>
  <tr>
    <th>X</th>
    <th>Machine</th>
    <th>Metric</th>
    <th>Test</th>
    <th>Detected</th>
    <th>Last Good Rev.</th>
    <th>First Bad Rev.</th>
    <th>Change</th>
    <th>Current</th>

  </tr>
  </thead>
  <tbody>
    {% for form_change in form.field_changes%}
        {% set ind = indicators[loop.index -1] %}
    <tr>
        <td>{{form_change}}</td>
         {% set graph_base=v4_url_for('v4_graph', highlight_run=ind.run.id) %}
        <td>{{utils.render_machine(ind.ri.machine)}}</td>
        <td>{{ind.ri.field.name}}</td>
        <td><a href="{{graph_base}}&plot.{{ind.ri.test.id}}={{ ind.ri.machine.id}}.{{ind.ri.test.id}}.{{ind.ri.field.index}}">{{ ind.ri.test.name }}</a></td>
        <td><span class="reltime" data-toggle="tooltip" title="{{ind.run.end_time}}">{{ ind.run.end_time.isoformat() }}</td>

        <td>{{utils.render_order_link(ind.ri.start_order)}}</td>
        <td>{{utils.render_order_link(ind.ri.end_order)}}</td>
        {{utils.get_regression_cell_value(ind.cr, analysis)}}
        {{utils.get_regression_cell_value(ind.latest_cr, analysis)}}

    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Button to trigger modal -->
<a href="#editRegressionModal" role="button" class="btn" data-toggle="modal">Edit</a>
 
<!-- Modal -->
<div id="editRegressionModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="editRegressionModal" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="editRegressionModal">Edit Regression</h3>
  </div>

     
      <div class="modal-body">
          <p>{{ form.title.label }}{{ form.title }}</p>
          <p>{{ form.bug.label }}{{form.bug }}</p>
      </div>
      <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          <input  name="save_btn" class="btn btn-primary" type="submit" value="Save Changes">

  </div>
</div>


<!-- Button to trigger modal -->
<a href="#splitRegressionModal" role="button" class="btn" data-toggle="modal">Split</a>
 
<!-- Modal -->
<div id="splitRegressionModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="splitRegressionModal" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="editRegressionModal">Split Regression</h3>
  </div>
     
      <div class="modal-body">
      Split selected changes into new regression. Are you sure?
      </div>
      <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          <input name="save_btn" class="btn btn-primary" type="submit" value="Split Regression">

  </div>
</div>
</form> 
{% endblock %}
